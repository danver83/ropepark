(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function n(t,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(s=i.key,r=void 0,r=function(t,o){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,o||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(t)}(s,"string"),"symbol"===e(r)?r:String(r)),i)}var s,r}var i=function(){function e(t,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLSelectElement))throw new TypeError("select must be a HTMLSelectElement");o="[object Object]"===Object.prototype.toString.call(o)?o:{},this.config={theme:["light","dark"].includes(o.theme)?o.theme:"light",height:o.height&&!isNaN(o.height)?o.height:40,iconSize:e.getIconSize(o.iconSize)},this.id=e.getId(),this.select=t,this.disabled=this.select.disabled,this.options=this.getOptions(),this.isDropdownOpened=!1,this.dropdownHeight=300,this.touchStartPos=-1,this.openDropdown=this.openDropdown.bind(this),this.handleDocClick=this.handleDocClick.bind(this),this.handleDocKeyDown=this.handleDocKeyDown.bind(this),this.handleOptionClick=this.handleOptionClick.bind(this),this.handleSelectChange=this.handleSelectChange.bind(this),this.preventScroll=this.preventScroll.bind(this),this.handleDropdownScroll=this.handleDropdownScroll.bind(this),this.updateDropdownPosition=this.updateDropdownPosition.bind(this),this.handleOptionFocus=this.handleOptionFocus.bind(this),this.init()}var o,i,s;return o=e,s=[{key:"getId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="tsel_",o=0;o<8;o++){var n=Math.floor(62*Math.random());t+=e.charAt(n)}return t}},{key:"getIconSize",value:function(e){var t=Array.isArray(e)?e:[e];return t.length||t.push(18,18),1===t.length&&t.push(t[0]),t.splice(2,t.length),t.every((function(e){return e&&!isNaN(e)}))?t:[18,18]}}],(i=[{key:"init",value:function(){var e=this.config,o=e.theme,n=e.height,i=document.createElement("button");i.classList.add("tsel"),i.type="button",i.role="combobox",i.ariaExpanded=!1,i.ariaControls=this.id,i.setAttribute("aria-owns",this.id),"dark"===o&&i.classList.add("tsel_dark"),i.style.height="".concat(n,"px"),this.disabled&&i.classList.add("tsel_disabled"),this.select.after(i),i.append(this.select),this.select.style.display="none";var s=document.createElement("div");s.classList.add("tsel-dropdown","tsel-dropdown_hidden"),"dark"===o&&s.classList.add("tsel-dropdown_dark"),s.role="listbox",s.id=this.id,this.createOptionsElements(),s.append.apply(s,t(this.options.map((function(e){return e.element}))));var r=document.createElement("div");r.classList.add("tsel-dropdown__scroll-top"),this.dropdownScrollTopIcon=r;var d=document.createElement("div");d.classList.add("tsel-dropdown__scroll-bottom"),this.dropdownScrollBottomIcon=d;var a=document.createElement("div");a.classList.add("tsel__selected-option"),i.append(a);var l=document.createElement("div");l.classList.add("tsel__noaction"),this.container=i,this.dropdown=s,this.selectedElement=a,this.noaction=l,this.setSelectedElement(),this.setHandlers()}},{key:"destroy",value:function(){this.closeDropdown(),this.container.removeEventListener("click",this.openDropdown),this.select.removeEventListener("change",this.handleSelectChange),this.removeOptionsHandlers(),this.container.before(this.select),this.container.remove()}},{key:"update",value:function(){var e;this.isDropdownOpened&&this.closeDropdown(),this.removeOptionsHandlers(),this.options.forEach((function(e){return e.element.remove()})),this.options=this.getOptions(),this.createOptionsElements(),this.setOptionsHandlers(),(e=this.dropdown).append.apply(e,t(this.options.map((function(e){return e.element})))),this.selectedElement.innerHTML="",this.setSelectedElement()}},{key:"getOptions",value:function(){return Array.from(this.select.options).map((function(e){return{value:e.value,img:e.getAttribute("data-img"),darkImg:e.getAttribute("data-img-dark"),label:e.innerText.replace(/\n/g,"").trim(),disabled:e.disabled,selected:e.selected,fontFamily:e.getAttribute("data-font-family"),fontWeight:e.getAttribute("data-font-weight")}}))}},{key:"createOptionsElements",value:function(){var e=this.options.some((function(e){return e.img})),t=this.config,o=t.theme,n=t.iconSize;this.options.forEach((function(t){var i=document.createElement("button");if(i.type="button",i.classList.add("tsel-dropdown__option"),t.selected&&(i.classList.add("tsel-dropdown__option_selected"),i.ariaSelected=!0),t.disabled&&(i.classList.add("tsel-dropdown__option_disabled"),i.disabled=!0),t.img||e){var s=document.createElement("div");s.classList.add("tsel-dropdown__option-image"),s.style.width="".concat(n[0],"px"),s.style.height="".concat(n[1],"px"),t.img?s.style.backgroundImage="url('".concat("dark"===o&&t.darkImg?t.darkImg:t.img,"')"):s.classList.add("tsel-dropdown__option-image_placeholder"),i.append(s)}if(t.label){var r=document.createElement("div");r.classList.add("tsel-dropdown__option-label");var d=document.createElement("span");d.classList.add("tsel-dropdown__option-span"),d.innerText=t.label,t.fontFamily&&(d.style.fontFamily="".concat(t.fontFamily,", tfutura, Arial, sans-serif")),t.fontWeight&&(d.style.fontWeight=t.fontWeight),r.append(d),i.append(r)}t.element=i}))}},{key:"setHandlers",value:function(){this.container.addEventListener("click",this.openDropdown),this.select.addEventListener("change",this.handleSelectChange),this.setOptionsHandlers()}},{key:"setOptionsHandlers",value:function(){var e=this;this.options.forEach((function(t){var o=t.element;o.addEventListener("mouseenter",e.handleOptionHover),o.addEventListener("mouseleave",e.handleOptionLeave),o.addEventListener("click",e.handleOptionClick),o.addEventListener("focus",e.handleOptionFocus),t.disabled||o.addEventListener("mousemove",e.handleOptionMousemove)}))}},{key:"removeOptionsHandlers",value:function(){var e=this;this.options.forEach((function(t){var o=t.element;o.removeEventListener("mouseenter",e.handleOptionHover),o.removeEventListener("mouseleave",e.handleOptionLeave),o.removeEventListener("click",e.handleOptionClick),o.removeEventListener("focus",e.handleOptionFocus),o.removeEventListener("mousemove",e.handleOptionMousemove)}))}},{key:"setSelectedElement",value:function(){var e,t=this.options.find((function(e){return e.selected}));if(t){var o=t.element.cloneNode(!0),n=o.querySelector(".tsel-dropdown__option-span");n&&n.removeAttribute("style");var i=Array.from(o.children);this.selectedElement.innerHTML="",(e=this.selectedElement).append.apply(e,i)}}},{key:"openDropdown",value:function(){var e;if(!this.disabled&&!this.isDropdownOpened&&this.options.length){var t=this.container.getBoundingClientRect(),o=document.documentElement.clientHeight;this.dropdownHeight=Math.max(Math.min(300,o-10)),this.dropdown.style.width="".concat(t.width,"px"),this.dropdown.style.maxHeight="".concat(this.dropdownHeight,"px"),this.dropdown.style.left="".concat(Math.max(5,t.left),"px"),document.body.append(this.noaction,this.dropdown);var n=(null===(e=this.options.find((function(e){return e.selected})))||void 0===e?void 0:e.element)||this.options[0].element;n.focus({preventScroll:!0});var i=Math.min(this.dropdown.offsetHeight,100),s=n.offsetTop+n.offsetHeight/2,r=this.dropdown.offsetHeight/2,d=s-r,a=this.dropdown.scrollHeight-this.dropdown.offsetHeight,l=0;d>a&&(l=d-a),d<0&&(l=d);var c=t.top+t.height/2,h=Math.min(o-10-i,Math.max(5,c-r-l)),p=Math.max(0,5-(c-r-l));this.dropdown.style.top="".concat(h,"px"),this.dropdownHeight=Math.max(i,Math.min(300-p,o-h-10)),this.dropdown.style.maxHeight="".concat(this.dropdownHeight,"px"),this.dropdown.scrollTop=d+p,document.addEventListener("click",this.handleDocClick),document.addEventListener("keydown",this.handleDocKeyDown,{capture:!0,passive:!1}),document.addEventListener("touchstart",this.preventScroll,{passive:!1}),document.addEventListener("touchmove",this.preventScroll,{passive:!1}),window.addEventListener("resize",this.updateDropdownPosition),document.addEventListener("wheel",this.preventScroll,{capture:!0,passive:!1}),this.dropdown.addEventListener("wheel",this.handleDropdownScroll,{passive:!1}),this.isDropdownOpened=!0,this.container.ariaExpanded=!0,this.dropdown.classList.remove("tsel-dropdown_hidden"),this.updateDropdownScrollIcons()}}},{key:"closeDropdown",value:function(){var e=this;this.dropdown.classList.add("tsel-dropdown_hidden"),window.setTimeout((function(){e.dropdown.scrollTop=0,e.dropdownScrollBottomIcon.remove(),e.dropdownScrollTopIcon.remove(),e.dropdown.remove(),e.noaction.remove(),document.removeEventListener("click",e.handleDocClick),document.removeEventListener("keydown",e.handleDocKeyDown,{capture:!0,passive:!1}),document.removeEventListener("touchstart",e.preventScroll,{passive:!1}),document.removeEventListener("touchmove",e.preventScroll,{passive:!1}),window.removeEventListener("resize",e.updateDropdownPosition),document.removeEventListener("wheel",e.preventScroll,{capture:!0,passive:!1}),e.dropdown.removeEventListener("wheel",e.handleDropdownScroll,{passive:!1}),e.dropdown.querySelectorAll(".tsel-dropdown__option-span").forEach((function(e){e.style.removeProperty("transition-duration"),e.style.removeProperty("transform")})),e.isDropdownOpened=!1,e.container.focus(),e.container.ariaExpanded=!1}),100)}},{key:"handleDocClick",value:function(e){this.container.contains(e.target)||this.dropdown.contains(e.target)||this.closeDropdown()}},{key:"handleDocKeyDown",value:function(e){if("Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),this.closeDropdown()),["ArrowUp","ArrowDown","PageUp","PageDown"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),["ArrowUp","ArrowDown"].includes(e.key))){var t=this.options.findIndex((function(e){return e.element===document.activeElement}));if("ArrowUp"===e.key){var o=Math.max(0,t-1),n=this.options.findLast((function(e,t){return!e.disabled&&t<=o}));n&&n.element.focus({preventScroll:!0})}else{var i=Math.min(this.options.length-1,t+1),s=this.options.find((function(e,t){return!e.disabled&&t>=i}));s&&s.element.focus({preventScroll:!0})}}"Tab"===e.key&&(e.preventDefault(),e.stopPropagation());var r=e.key.toLowerCase();if(/^[a-zа-я]$/.test(r)){e.preventDefault(),e.stopPropagation();var d=this.options.find((function(e){return e.label.toLowerCase().startsWith(r)}));d&&d.element.focus({preventScroll:!0})}}},{key:"preventScroll",value:function(e){if(this.dropdown.contains(e.target)){var t,o=this.dropdown.scrollHeight,n=this.dropdown.scrollTop,i=this.dropdown.offsetHeight,s=Math.abs(n-(o-i))<1;if(e.deltaY<0&&!n||e.deltaY>=0&&s||["touchstart","touchmove"].includes(e.type))if("touchstart"!==e.type&&e.preventDefault(),"touchstart"===e.type&&(this.touchStartPos=(null===(t=e.touches[0])||void 0===t?void 0:t.clientY)||-1),"touchmove"===e.type&&this.touchStartPos>-1){var r,d=(null===(r=e.changedTouches[0])||void 0===r?void 0:r.clientY)||-1,a=this.touchStartPos;this.touchStartPos=d,d>-1&&this.dropdown.dispatchEvent(new WheelEvent("wheel",{deltaY:a-d}))}}else"touchstart"!==e.type&&(e.preventDefault(),e.stopPropagation())}},{key:"handleOptionHover",value:function(){var e=this.querySelector(".tsel-dropdown__option-span");if(e){var t=e.parentElement.offsetWidth-e.offsetWidth;if(t=Math.min(t,0)){var o=Math.abs(t)/60;e.style.setProperty("transition-duration","".concat(o,"s")),e.style.setProperty("transform","translateX(".concat(t,"px)"))}}}},{key:"handleOptionLeave",value:function(){var e=this.querySelector(".tsel-dropdown__option-span");e&&(e.style.removeProperty("transition-duration"),e.style.removeProperty("transform"))}},{key:"handleOptionClick",value:function(e){var t=this,o=e.target.closest(".tsel-dropdown__option"),n=this.options.find((function(e){return e.element===o}));n.disabled||(n.selected||(this.select.value=n.value,window.setTimeout((function(){t.select.dispatchEvent(new Event("change"))}),100)),this.closeDropdown())}},{key:"handleOptionMousemove",value:function(){document.activeElement!==this&&this.focus({preventScroll:!0})}},{key:"handleOptionFocus",value:function(e){var t=e.target.getBoundingClientRect(),o=this.dropdown.getBoundingClientRect(),n=t.top-o.top,i=n+t.height-o.height;n<0?this.dropdown.dispatchEvent(new WheelEvent("wheel",{deltaY:n-15})):i>0&&this.dropdown.dispatchEvent(new WheelEvent("wheel",{deltaY:i+15}))}},{key:"handleSelectChange",value:function(){var e=this.select.value,t=this.options.find((function(t){return t.value===e}));if(t){var o=this.options.find((function(e){return e.selected}));o&&(o.selected=!1,o.element.classList.remove("tsel-dropdown__option_selected"),o.element.ariaSelected=!1),t.selected=!0,t.element.classList.add("tsel-dropdown__option_selected"),t.element.ariaSelected=!0,this.setSelectedElement()}}},{key:"handleDropdownScroll",value:function(e){var t=this;e.preventDefault();var o=e.deltaY,n=Math.abs(o)>10,i=n?o-o/10:0;o=n?o/10:o;var s=document.documentElement.clientHeight,r=this.dropdown.offsetTop,d=this.dropdown.scrollTop,a=this.dropdown.scrollHeight,l=this.dropdown.offsetHeight,c=Math.abs(d-(a-l))<1;if(this.dropdownHeight===s-10||!o||5===r&&o>0||o>0&&c||o<0&&0===d)return this.dropdown.scrollTop=d+o,this.updateDropdownScrollIcons(),void(n&&window.setTimeout((function(){t.dropdown.dispatchEvent(new WheelEvent("wheel",{deltaY:i}))}),0));var h=Math.max(5,r-Math.abs(o));r>5&&o>0&&(this.dropdown.style.top="".concat(h,"px")),o<0&&(this.dropdown.scrollTop=d+o),this.dropdownHeight+=Math.abs(o),this.dropdownHeight=Math.min(this.dropdownHeight,s-this.dropdown.offsetTop-5),this.dropdown.style.maxHeight="".concat(this.dropdownHeight,"px"),this.updateDropdownScrollIcons(),n&&window.setTimeout((function(){t.dropdown.dispatchEvent(new WheelEvent("wheel",{deltaY:i}))}),0)}},{key:"updateDropdownPosition",value:function(){if(this.isDropdownOpened){var e=this.container.getBoundingClientRect();this.dropdown.style.width="".concat(e.width,"px"),this.dropdown.style.left="".concat(Math.max(5,e.left),"px")}}},{key:"updateDropdownScrollIcons",value:function(){var e=this.dropdown,t=e.scrollTop,o=e.offsetHeight,n=e.scrollHeight,i=n-o;t>0?this.dropdown.prepend(this.dropdownScrollTopIcon):this.dropdownScrollTopIcon.remove(),n!==o&&Math.abs(t-i)>=1?this.dropdown.append(this.dropdownScrollBottomIcon):this.dropdownScrollBottomIcon.remove()}}])&&n(o.prototype,i),s&&n(o,s),Object.defineProperty(o,"prototype",{writable:!1}),e}();window.TSelectbox=i})();