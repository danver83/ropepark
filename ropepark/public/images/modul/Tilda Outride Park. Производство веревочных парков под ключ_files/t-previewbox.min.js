(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:String(n)}var r=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLSelectElement))throw new TypeError("select must be a HTMLSelectElement");n="[object Object]"===Object.prototype.toString.call(n)?n:{},this.config={theme:["light","dark"].includes(n.theme)?n.theme:"light",height:n.height&&!isNaN(n.height)?n.height:40,imageSize:e.getImageSize(n.imageSize),columnsCount:n.columnsCount&&!isNaN(n.columnsCount)?n.columnsCount:2,insertSVG:!!n.insertSVG},this.id=e.getId(),this.select=t,this.disabled=this.select.disabled,this.options=this.getOptions(),this.isDropdownOpened=!1,this.openDropdown=this.openDropdown.bind(this),this.handleSelectChange=this.handleSelectChange.bind(this),this.handleOptionMouseenter=this.handleOptionMouseenter.bind(this),this.handleOptionMouseleave=this.handleOptionMouseleave.bind(this),this.handleOptionClick=this.handleOptionClick.bind(this),this.handleDocClick=this.handleDocClick.bind(this),this.handleDocKeyDown=this.handleDocKeyDown.bind(this),this.preventScroll=this.preventScroll.bind(this),this.updateDropdownOverflow=this.updateDropdownOverflow.bind(this),this.init()}var n,o,r;return n=e,r=[{key:"getId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="tprev_",n=0;n<8;n++){var i=Math.floor(62*Math.random());t+=e.charAt(i)}return t}},{key:"getImageSize",value:function(e){var t=Array.isArray(e)?e:[e];return t.length||t.push(180,120),1===t.length&&t.push(t[0]),t.splice(2,t.length),t.every((function(e){return e&&!isNaN(e)}))?t:[180,120]}}],(o=[{key:"init",value:function(){var e=this.config,n=e.theme,i=e.height,o=e.imageSize,r=e.columnsCount,s=document.createElement("button");s.classList.add("tprev"),s.setAttribute("type","button"),s.setAttribute("role","combobox"),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",this.id),s.setAttribute("aria-owns",this.id),"dark"===n&&s.classList.add("tprev_dark"),s.style.height="".concat(i,"px"),this.disabled&&s.classList.add("tprev_disabled"),this.select.after(s),s.append(this.select),this.select.style.display="none";var a=document.createElement("div");a.classList.add("tprev__selected-option");var d=this.options.find((function(e){return e.selected}));d&&(a.innerHTML=d.label),s.append(a);var l=document.createElement("div");l.classList.add("tprev-dropdown","tprev-dropdown_hidden"),"dark"===n&&l.classList.add("tprev-dropdown_dark"),l.id=this.id;var c=document.createElement("div");c.classList.add("tprev-dropdown__inner"),c.setAttribute("role","listbox"),c.style.gridTemplateColumns="repeat(".concat(r,", ").concat(o[0],"px)"),this.createOptionsElements(),c.append.apply(c,t(this.options.map((function(e){return e.element})))),l.append(c);var p=document.createElement("div");p.classList.add("tprev__noaction"),this.container=s,this.selectedOption=a,this.dropdown=l,this.dropdownInner=c,this.noaction=p,this.setHandlers()}},{key:"getOptions",value:function(){return Array.from(this.select.options).map((function(e){return{value:e.value,img:e.getAttribute("data-img")||"",darkImg:e.getAttribute("data-img-dark")||"",label:e.innerText.replace(/\n/g,"").trim(),disabled:e.disabled,selected:e.selected}}))}},{key:"createOptionsElements",value:function(){var e=this.config,t=e.theme,n=e.imageSize,i=e.insertSVG;this.options.forEach((function(e){var o=document.createElement("button");o.type="button",o.classList.add("tprev-dropdown__option"),e.selected&&(o.classList.add("tprev-dropdown__option_selected"),o.ariaSelected=!0),e.disabled&&(o.classList.add("tprev-dropdown__option_disabled"),o.disabled=!0);var r=document.createElement("div");if(r.classList.add("tprev-dropdown__option-image"),r.style.width="".concat(n[0],"px"),r.style.height="".concat(n[1],"px"),e.imageElement=r,o.append(r),e.img){var s="dark"===t&&e.darkImg?e.darkImg:e.img,a=s.endsWith(".svg");e.imgURL=s,e.isSVG=a,a&&i||(r.style.backgroundImage="url('".concat(s,"')"))}var d=document.createElement("div");d.classList.add("tprev-dropdown__option-label"),d.innerHTML=e.label,d.style.maxWidth="".concat(n[0],"px"),o.append(d),e.element=o}))}},{key:"setHandlers",value:function(){this.container.addEventListener("click",this.openDropdown),this.select.addEventListener("change",this.handleSelectChange),this.setOptionsHandlers()}},{key:"setOptionsHandlers",value:function(){var e=this;this.options.forEach((function(t){var n=t.element;n.addEventListener("click",e.handleOptionClick),t.disabled||(n.addEventListener("mouseenter",e.handleOptionMouseenter),n.addEventListener("mouseleave",e.handleOptionMouseleave))}))}},{key:"update",value:function(){var e;this.isDropdownOpened&&this.closeDropdown(),this.removeOptionsHandlers(),this.options.forEach((function(e){return e.element.remove()})),this.options=this.getOptions(),this.createOptionsElements(),this.setOptionsHandlers(),(e=this.dropdownInner).append.apply(e,t(this.options.map((function(e){return e.element})))),this.selectedOption.innerHTML="";var n=this.options.find((function(e){return e.selected}));n&&(this.selectedOption.innerHTML=n.label)}},{key:"destroy",value:function(){this.closeDropdown(),this.container.removeEventListener("click",this.openDropdown),this.select.removeEventListener("change",this.handleSelectChange),this.removeOptionsHandlers(),this.container.before(this.select),this.container.remove()}},{key:"removeOptionsHandlers",value:function(){var e=this;this.options.forEach((function(t){var n=t.element;n.removeEventListener("click",e.handleOptionClick),n.removeEventListener("mouseenter",e.handleOptionMouseenter),n.removeEventListener("mouseleave",e.handleOptionMouseleave)}))}},{key:"openDropdown",value:function(){var e=this;if(!this.disabled&&!this.isDropdownOpened&&this.options.length){document.addEventListener("click",this.handleDocClick),document.addEventListener("keydown",this.handleDocKeyDown,{capture:!0,passive:!1}),document.addEventListener("wheel",this.preventScroll,{capture:!0,passive:!1}),this.dropdownInner.addEventListener("scroll",this.updateDropdownOverflow);var t=this.container.getBoundingClientRect(),n=t.top,i=t.right+10,o=n-10;this.dropdown.style.setProperty("--pos-x","".concat(i,"px")),this.dropdown.style.setProperty("--pos-y","".concat(o,"px")),document.body.append(this.dropdown),document.body.append(this.noaction),this.isDropdownOpened=!0,this.container.setAttribute("aria-expanded","true"),this.container.classList.add("tprev_active");var r=this.options.find((function(e){return e.selected}));r&&r.element.scrollIntoView({behavior:"smooth",inline:"start",block:"center"}),this.updateDropdownOverflow(),this.dropdown.classList.remove("tprev-dropdown_hidden"),this.config.insertSVG&&this.options.forEach((function(t){var n=t.imgURL,i=t.isSVG;n&&i&&e.loadSVG(n,t)}))}}},{key:"closeDropdown",value:function(){var e=this;this.dropdown.classList.add("tprev-dropdown_hidden"),this.dropdown.addEventListener("transitionend",(function(){document.removeEventListener("click",e.handleDocClick),document.removeEventListener("keydown",e.handleDocKeyDown,{capture:!0,passive:!1}),document.removeEventListener("wheel",e.preventScroll,{capture:!0,passive:!1}),e.dropdownInner.removeEventListener("scroll",e.updateDropdownOverflow),e.dropdown.remove(),e.noaction.remove(),e.isDropdownOpened=!1,e.container.focus(),e.container.setAttribute("aria-expanded","false"),e.container.classList.remove("tprev_active")}),{once:!0})}},{key:"updateDropdownOverflow",value:function(){if(this.isDropdownOpened){this.dropdown.classList.remove("tprev-dropdown_scroll-start","tprev-dropdown_scroll-end");var e=this.dropdownInner,t=e.scrollTop,n=e.scrollLeft,i=e.offsetHeight,o=e.offsetWidth,r=e.scrollHeight,s=e.scrollWidth,a=Math.abs(t-(r-i))<1||r===i,d=Math.abs(n-(s-o))<1||s===o;(s>o||r>o)&&(this.dropdown.classList.toggle("tprev-dropdown_scroll-start",n||t),this.dropdown.classList.toggle("tprev-dropdown_scroll-end",!d||!a))}}},{key:"handleSelectChange",value:function(){var e=this.select.value,t=this.options.find((function(t){return t.value===e}));if(t){var n=this.options.find((function(e){return e.selected}));n&&(n.selected=!1,n.element.classList.remove("tprev-dropdown__option_selected"),n.element.ariaSelected=!1),t.selected=!0,t.element.classList.add("tprev-dropdown__option_selected"),t.element.ariaSelected=!0,this.selectedOption.innerHTML=t.label}}},{key:"handleOptionClick",value:function(e){var t=this,n=e.currentTarget,i=this.options.find((function(e){return e.element===n}));i.disabled||(this.select.value=i.value,window.setTimeout((function(){t.select.dispatchEvent(new CustomEvent("interaction")),i.selected||t.select.dispatchEvent(new Event("change"))}),100),this.closeDropdown())}},{key:"handleOptionMouseenter",value:function(e){var t=e.currentTarget,n=this.options.find((function(e){return e.element===t}));n&&!n.disabled&&t.focus()}},{key:"handleOptionMouseleave",value:function(e){var t=e.currentTarget,n=this.options.find((function(e){return e.element===t}));n&&!n.disabled&&t.blur()}},{key:"handleDocClick",value:function(e){this.container.contains(e.target)||this.dropdown.contains(e.target)||this.closeDropdown()}},{key:"handleDocKeyDown",value:function(e){if("Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),this.closeDropdown()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Tab"].includes(e.key)&&(e.preventDefault(),e.stopPropagation()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var t=this.config.columnsCount,n=this.options.findIndex((function(e){return e.element===document.activeElement})),i=n%t,o=["ArrowUp","ArrowDown"].includes(e.key)?t:1;if("ArrowLeft"===e.key&&!i||"ArrowRight"===e.key&&i===t-1)return;var r=n+(["ArrowUp","ArrowLeft"].includes(e.key)?-o:o),s=this.options.find((function(e,t){return!e.disabled&&t===r}));s&&s.element.focus()}var a=e.key.toLowerCase();if(/^[a-zа-я]$/.test(a)){e.preventDefault(),e.stopPropagation();var d=this.options.find((function(e){return e.label.toLowerCase().startsWith(a)}));d&&d.element.focus()}}},{key:"preventScroll",value:function(e){if(this.dropdown.contains(e.target)){var t=e.deltaY,n=e.deltaX,i=this.dropdownInner,o=i.scrollTop,r=i.scrollLeft,s=i.offsetHeight,a=i.offsetWidth,d=i.scrollHeight,l=i.scrollWidth,c=Math.abs(o-(d-s))<1,p=Math.abs(r-(l-a))<1,h=l>a,u=d>s;(t<0&&!o&&u||t>0&&c&&u||n<0&&!r&&h||n>0&&p&&h)&&e.preventDefault()}else e.preventDefault()}},{key:"loadSVG",value:function(e,t){var n=this.config.imageSize,i=t.imageElement;t.fetchedSVGPromise||(t.fetchedSVGPromise=fetch(e,{method:"GET",headers:{Accept:"image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}}).then((function(e){return e.text()})).then((function(e){var t=(new DOMParser).parseFromString(e,"image/svg+xml").firstElementChild;if(!(t instanceof SVGElement))throw new Error;return t.classList.add("tprev-dropdown__option-image"),t.setAttribute("width",n[0]),t.setAttribute("height",n[1]),t.setAttribute("preserveAspectRatio","xMidYMid meet"),i.replaceWith(t),t})).catch((function(){delete t.fetchedSVGPromise})))}}])&&i(n.prototype,o),r&&i(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.TPreviewbox=r})();